SELECT "conversations".* FROM "conversations"
LEFT OUTER JOIN invites ON conversations.id = invites.conversation_id
LEFT OUTER JOIN memberships ON memberships.conversation_id = conversations.id
LEFT OUTER JOIN users ON users.id = memberships.user_id
WHERE (("users"."phone_normalized" IN ('+16666666666', '+13475694395') OR "users"."phone_normalized" IS NULL))
AND (("invites"."phone" IN ('+16666666666', '+13475694395') OR "invites"."phone" IS NULL))
GROUP BY conversations.id HAVING (count(invites.id) + count(users.id)) = 2 LIMIT 1

SELECT "conversations".*, count(invites.id) as invite_count, count(users.id) as user_count FROM "conversations" LEFT OUTER JOIN invites ON conversations.id = invites.conversation_id LEFT OUTER JOIN memberships ON memberships.conversation_id = conversations.id LEFT OUTER JOIN users ON users.id = memberships.user_id WHERE (("users"."phone_normalized" IN ('+16666666666', '+13475694395') OR "users"."phone_normalized" IS NULL)) AND (("invites"."phone" IN ('+16666666666', '+13475694395') OR "invites"."phone" IS NULL)) GROUP BY conversations.id HAVING (count(invites.id) + count(users.id)) = 2 LIMIT 1

SELECT "conversations".* FROM "conversations" LEFT OUTER JOIN invites ON conversations.id = invites.conversation_id LEFT OUTER JOIN memberships ON memberships.conversation_id = conversations.id LEFT OUTER JOIN users ON users.id = memberships.user_id WHERE (("users"."phone_normalized" IN ('+16666666666', '+13475694395') OR "users"."phone_normalized" IS NULL)) AND (("invites"."phone" IN ('+16666666666', '+13475694395') OR "invites"."phone" IS NULL)) GROUP BY conversations.id HAVING (count(invites.id) + count(users.id)) = 2 LIMIT 1

SELECT "conversations".* FROM "conversations" LEFT OUTER JOIN invites ON conversations.id = invites.conversation_id LEFT OUTER JOIN memberships ON memberships.conversation_id = conversations.id LEFT OUTER JOIN users ON users.id = memberships.user_id WHERE (("users"."phone_normalized" IN ('+16666666666', '+13475694395') OR "users"."phone_normalized" IS NULL)) AND (("invites"."phone" IN ('+16666666666', '+13475694395') OR "invites"."phone" IS NULL))


SELECT conversations.*, (
    select count(*) FROM invites
    where invites.conversation_id = conversations.id
    where invites.phone IN ('+16666666666', '+13475694395')
  ) as invites_count
  FROM conversations


select conversations
left 


SELECT conversations.*, (select count(*) FROM invites where invites.conversation_id = conversations.id and invites.phone IN ('+16666666666', '+13475694395')) as invites_count FROM conversations


  (select count(*) FROM invites WHERE "conversation_i) as membesr_count
  WHERE invites_count + members_count > ? 

SELECT conversations.*, (select count(*) FROM invites WHERE invites.conversation_id = conversations.id) as invites_count FROM conversations

select conversation_id, count(sub.phone)
from (
  select memberships.conversation_id, memberships.id as m_id, users.phone_normalized as phone
  from memberships
  join users on users.id = memberships.user_id
  where users.phone_normalized in ('+13475694395','+18587614144')
  ) as sub
group by conversation_id
having count(sub.phone) = 1
